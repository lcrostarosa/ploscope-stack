# OpenVPN Access Server Configuration
# This file contains the key configuration settings for OpenVPN Access Server

# Basic server settings
host.name=vpn.ploscope.com
admin_ui.https.port=943
cs.https.port=943


# OpenVPN AS configuration file
#
# NOTE:  The ~ symbol used below expands to the directory that
# the configuration file is saved in

# remove for production
# DEBUG=false

# temporary directory
tmp_dir=/ovpn/tmp

lic.dir=~/licenses

# run_start retries
run_start_retry.give_up=60
run_start_retry.resample=10

# enable client gateway
sa.show_c2s_routes=true

# certificates database
certs_db=sqlite:///~/db/certs.db

# user properties DB
user_prop_db=sqlite:///~/db/userprop.db

# configuration DB
config_db=sqlite:///~/db/config.db

# Local configuration DB - this must remain a SQLite type database
config_db_local=sqlite:///~/db/config_local.db

# cluster DB
cluster_db=sqlite:///~/db/cluster.db

# notification DB
notification_db=sqlite:///~/db/notification.db

# log DB
# If log_db line is deleted or commented out, logging to DB will be disabled
# Note that disabling logging to DB will not disable logging to file, syslog or stdout.
log_db=sqlite:///~/db/log.db

# wait this many seconds between failed retries
db_retry.interval=1

# how many retries to attempt before failing
db_retry.n_attempts=6

# On startup, wait up to n seconds for DB files to become
# available if they do not yet exist.  This is generally
# only useful on secondary nodes used for standby purposes.
# db_startup_wait=

# Node type: PRIMARY|SECONDARY.  Defaults to PRIMARY.
# node_type=


# User for web service with PAM authentication
boot_pam_service=openvpnas

# System users that are allowed to access the server agent XML API.
# The user that the web server will run as should be in this list.
system_users_local.0=root
system_users_local.1=openvpn_as

# The user/group that the web server will run as
cs.user=openvpn_as
cs.group=openvpn_as

# socket directory
general.sock_dir=/ovpn/sock

# path to linux openvpn executable
# if undefined, find openvpn on the PATH
#general.openvpn_exe_path=

# source directory for OpenVPN Windows executable
# (Must have been built with MultiFileExtract)
sa.win_exe_dir=~/exe

# The company name will be shown in the UI
# sa.company_name=Access Server

# server agent socket
sa.sock=/ovpn/sock/sagent

# web server will use three consecutive ports starting at this
# address, for use with the OpenVPN port share feature
cs.dynamic_port_base=870

# which service groups should be started during
# server agent initialization
sa.initial_run_groups.0=web_group
sa.initial_run_groups.1=openvpn_group

# The unit number of this particular AS configuration.
# Normally set to 0.  If you have multiple, independent AS instances
# running on the same machine, each should have a unique unit number.
sa.unit=0

# If true, open up web ports on the firewall using iptables
iptables.web=true

vpn.server.user=openvpn_as
vpn.server.group=openvpn_as


vpn.daemon.0.listen.ip_address=all
vpn.daemon.0.listen.port=443
vpn.daemon.0.server.ip_address=all
vpn.server.daemon.tcp.port=443
vpn.server.daemon.tcp.n_daemons=8
vpn.server.daemon.udp.n_daemons=8

# Port sharing (allows web interface and VPN on same port)
vpn.server.port_share.enable=true

# DNS configuration for VPN clients - Split tunnel DNS
# Primary DNS server for ploscope.com domain resolution (CoreDNS)
vpn.server.dhcp_option.dns.0=172.18.1.30
# Fallback DNS servers for other domains
# vpn.server.dhcp_option.dns.1=8.8.8.8
# vpn.server.dhcp_option.dns.2=1.1.1.1

# Domain configuration for ploscope services
vpn.server.dhcp_option.domain=ploscope.com
vpn.server.dhcp_option.search_domain=ploscope.com

# Split DNS configuration - route ploscope.com queries through VPN
vpn.server.dhcp_option.dns_search=ploscope.com

# Client routing settings - Split tunnel configuration
vpn.client.routing.reroute_dns=true
vpn.client.routing.reroute_gw=false

# Private network routing - Route internal networks through VPN
vpn.server.routing.private_access=nat
vpn.server.routing.private_network.0=172.18.0.0/16

# Client subnet configuration
vpn.server.routing.vpn.client.subnet=172.27.224.0/20

# NAT configuration for internet access
vpn.server.routing.nat_gateway=true

# Internet routing - Split tunnel configuration
vpn.client.routing.inter_client=true
vpn.server.routing.gateway_access=false

# Push routes only for ploscope domains - Split tunnel configuration
# Route for internal Docker network containing ploscope services
vpn.server.routing.push_route.0=172.18.0.0/16

# Split tunnel configuration - Custom routing for ploscope domains
# Enable custom routing rules for domain-based traffic
vpn.server.routing.custom_routes=true

# Domain-based routing configuration
vpn.server.routing.domain_routes.0=ploscope.com
vpn.server.routing.domain_routes.1=*.ploscope.com

# Additional NAT rules for internet connectivity
vpn.server.routing.nat_rules.0=SNAT --to-source 172.27.224.1 -o eth0
# vpn.server.routing.nat_rules.1=SNAT --to-source %i -o enp+

# Authentication
auth.module.type=local
auth.local.0.enable=true

# Security settings
vpn.server.tls_cc_security=tls-crypt

# Web server certificate configuration
web.server.cert=/openvpn/etc/web-ssl/server.crt
web.server.key=/openvpn/etc/web-ssl/server.key
web.server.cert.auto=false
web.server.cert_chain=/openvpn/etc/web-ssl/server.crt

# If enabled, automatically generate a client configuration
# when a client logs into the site and successfully authenticates
cs.auto_generate=true

# files for web server (PEM format)
cs.ca_bundle=~/web-ssl/ca.crt
cs.priv_key=~/web-ssl/server.key
cs.cert=~/web-ssl/server.crt

# The CA key is only needed when AS should try to
# autorenew the self-signed web certificate
cs.ca_key=~/web-ssl/ca.key
