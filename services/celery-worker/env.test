# ===========================================
# Celery Worker - Test Environment
# ===========================================

# Application Environment
# -----------------------
LOG_LEVEL=DEBUG
TESTING=true

# Database Configuration (mock/in-memory for unit tests)
# ----------------------
DATABASE_URL=sqlite:///:memory:
POSTGRES_USER=test
POSTGRES_PASSWORD=test
POSTGRES_DB=test
POSTGRES_HOST=localhost
POSTGRES_PORT=5432

# Security
# --------
SECRET_KEY=test-secret-key

# RabbitMQ Configs (mock for unit tests)
RABBITMQ_VHOST=/test
RABBITMQ_USERNAME=test
RABBITMQ_PASSWORD=test
RABBITMQ_HOST=localhost
RABBITMQ_PORT=5672
RABBITMQ_MAIN_EXCHANGE=test.main
RABBITMQ_DLQ_EXCHANGE=test.dlq
RABBITMQ_MAIN_EXCHANGE_TYPE=topic
RABBITMQ_DLQ_EXCHANGE_TYPE=topic

# RabbitMQ Queue Configuration
# ----------------------------
RABBITMQ_SPOT_QUEUE=test-spot-processing
RABBITMQ_SOLVER_QUEUE=test-solver-processing
RABBITMQ_SPOT_DLQ=test-spot-processing-dlq
RABBITMQ_SOLVER_DLQ=test-solver-processing-dlq

# Celery Configuration
# --------------------
CELERY_BROKER_URL=memory://
CELERY_RESULT_BACKEND=cache+memory://
CELERY_TASK_SERIALIZER=json
CELERY_RESULT_SERIALIZER=json
CELERY_ACCEPT_CONTENT=['json']
CELERY_TIMEZONE=UTC
CELERY_ENABLE_UTC=True
CELERY_TASK_TRACK_STARTED=True
CELERY_TASK_TIME_LIMIT=30*60  # 30 minutes
CELERY_TASK_SOFT_TIME_LIMIT=25*60  # 25 minutes
CELERY_WORKER_PREFETCH_MULTIPLIER=1
CELERY_WORKER_MAX_TASKS_PER_CHILD=1000
CELERY_WORKER_CONCURRENCY=4
CELERY_HEALTH_PORT=5002
CELERY_WORKER_POOL=threads

# Workaround for macOS fork safety in child processes
OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES

# Redis Configuration (mock for unit tests)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=test
REDIS_URL=redis://:test@localhost:6379/0

# Docker Configuration
BUILD_ENV=test
RESTART_POLICY=unless-stopped
VOLUME_MODE=rw
